<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Agregar Cita</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h2 class="text-primary fw-bold mb-4">Agregar Nueva Cita Médica</h2>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form method="POST" class="needs-validation" novalidate>
        <!-- ✅ Token CSRF oculto correctamente -->
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="mb-3">
          <label for="nombre" class="form-label">Nombre:</label>
          <input
            type="text"
            class="form-control"
            id="nombre"
            name="nombre"
            required
          />
          <div class="invalid-feedback">Por favor ingresa el nombre.</div>
        </div>

        <div class="mb-3">
          <label for="apellido" class="form-label">Apellido:</label>
          <input
            type="text"
            class="form-control"
            id="apellido"
            name="apellido"
            required
          />
          <div class="invalid-feedback">Por favor ingresa el apellido.</div>
        </div>

        <div class="mb-3">
          <label for="fecha" class="form-label">Fecha (DD/MM/AAAA):</label>
          <input
            type="text"
            class="form-control"
            id="fecha"
            name="fecha"
            required
            pattern="^(0[1-9]|[12][0-9]|3[01])/(0[1-9]|1[0-2])/([0-9]{4})$"
            title="Formato válido: DD/MM/AAAA"
          />
          <div class="invalid-feedback">Por favor ingresa una fecha válida.</div>
        </div>

        <div class="mb-3">
          <label for="telefono" class="form-label">Teléfono:</label>
          <input
            type="text"
            class="form-control"
            id="telefono"
            name="telefono"
            required
            pattern="^\+?\d{8,15}$"
            title="Entre 8 y 15 dígitos. Puede comenzar con +"
          />
          <div class="invalid-feedback">
            Por favor ingresa un teléfono válido (entre 8 y 15 dígitos, opcional +).
          </div>
        </div>

        <div class="mb-4">
          <label for="especialidad" class="form-label">Especialidad:</label>
          <select
            class="form-select"
            id="especialidad"
            name="especialidad"
            required
          >
            <option value="" disabled selected>Seleccionar</option>
            <option value="Pediatría">Pediatría</option>
            <option value="Medicina General">Medicina General</option>
            <option value="Cardiología">Cardiología</option>
            <option value="Ginecología">Ginecología</option>
          </select>
          <div class="invalid-feedback">Selecciona una especialidad.</div>
        </div>

        <button type="submit" class="btn btn-primary">Guardar Cita</button>
        <a href="{{ url_for('main.index') }}" class="btn btn-secondary">Volver</a>
      </form>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
