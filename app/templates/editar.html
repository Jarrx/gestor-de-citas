<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Editar Cita</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body class="container mt-5">
    <h2>Editar Cita M√©dica</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
    {% endwith %}

    <form method="POST" class="needs-validation" novalidate>
      <!-- üîí Protecci√≥n CSRF -->
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre:</label>
        <input
          type="text"
          class="form-control"
          id="nombre"
          name="nombre"
          value="{{ cita.nombre }}"
          required
        />
        <div class="invalid-feedback">Por favor ingresa el nombre.</div>
      </div>

      <div class="mb-3">
        <label for="apellido" class="form-label">Apellido:</label>
        <input
          type="text"
          class="form-control"
          id="apellido"
          name="apellido"
          value="{{ cita.apellido }}"
          required
        />
        <div class="invalid-feedback">Por favor ingresa el apellido.</div>
      </div>

      <div class="mb-3">
        <label for="fecha" class="form-label">Fecha (DD/MM/AAAA):</label>
        <input
          type="text"
          class="form-control"
          id="fecha"
          name="fecha"
          value="{{ cita.fecha.strftime('%d/%m/%Y') }}"
          required
          pattern="^(0[1-9]|[12][0-9]|3[01])/(0[1-9]|1[0-2])/([0-9]{4})$"
          title="Formato v√°lido: DD/MM/AAAA"
        />
        <div class="invalid-feedback">Por favor ingresa una fecha v√°lida.</div>
      </div>

      <div class="mb-3">
        <label for="telefono" class="form-label">Tel√©fono:</label>
        <input
          type="text"
          class="form-control"
          id="telefono"
          name="telefono"
          value="{{ cita.telefono or '' }}"
          required
          pattern="^\+?\d{8,15}$"
          title="Entre 8 y 15 d√≠gitos. Puede comenzar con +"
        />
        <div class="invalid-feedback">
          Por favor ingresa un tel√©fono v√°lido (entre 8 y 15 d√≠gitos, opcional +).
        </div>
      </div>

      <div class="mb-3">
        <label for="especialidad" class="form-label">Especialidad:</label>
        <select
          class="form-select"
          id="especialidad"
          name="especialidad"
          required
        >
          <option value="" disabled>Seleccionar</option>
          <option value="Pediatr√≠a" {% if cita.especialidad == 'Pediatr√≠a' %}selected{% endif %}>Pediatr√≠a</option>
          <option value="Medicina General" {% if cita.especialidad == 'Medicina General' %}selected{% endif %}>Medicina General</option>
          <option value="Cardiolog√≠a" {% if cita.especialidad == 'Cardiolog√≠a' %}selected{% endif %}>Cardiolog√≠a</option>
          <option value="Ginecolog√≠a" {% if cita.especialidad == 'Ginecolog√≠a' %}selected{% endif %}>Ginecolog√≠a</option>
        </select>
        <div class="invalid-feedback">Selecciona una especialidad.</div>
      </div>

      <div class="mb-3">
        <label for="estado" class="form-label">Estado:</label>
        <select class="form-select" id="estado" name="estado" required>
          <option value="" {% if not cita.estado %}selected{% endif %} disabled hidden>Seleccionar estado</option>
          <option value="Pendiente" {% if cita.estado == 'Pendiente' %}selected{% endif %}>Pendiente</option>
          <option value="Completada" {% if cita.estado == 'Completada' %}selected{% endif %}>Completada</option>
          <option value="Cancelada" {% if cita.estado == 'Cancelada' %}selected{% endif %}>Cancelada</option>
        </select>
      </div>

      <button type="submit" class="btn btn-primary">Guardar Cambios</button>
      <a href="{{ url_for('main.index') }}" class="btn btn-secondary">Volver</a>
    </form>

    <!-- Script para activar validaci√≥n Bootstrap -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const forms = document.querySelectorAll(".needs-validation");
        Array.from(forms).forEach((form) => {
          form.addEventListener("submit", (event) => {
            if (!form.checkValidity()) {
              event.preventDefault();
              event.stopPropagation();
            }
            form.classList.add("was-validated");
          });
        });
      });
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
